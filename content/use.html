---
title: Working with containers
type: page
layout: sidemenu

---



<div id="shared-volumes" class="tab-pane active">
<h2 id="shared-volumes">Shared Volumes</h2>
<p>A common configuration with Rocker containers is to share volumes between the container and the host filesystem. This allows the container to access and modify local files in directories you specify. In this way, the container can be treated as ephemeral while files you create will persist after the container is destroyed. Because the container only has access to files within the directories you specify, this can also prevent a user from accidentally modifying unrelated files on the file system when using software inside the container.</p>
<p>To share a volume with the host we use the <code>-v</code> or <code>--volume</code> flag. Simply indicate the location on the host machine on the left side of <code>:</code>, and indicate the location on the container to the right. For instance:</p>
<pre class="bash"><code>docker run -d -p 8787:8787 -v /Users/bob/Documents:/home/rstudio/Documents rocker/rstudio</code></pre>
<p>would link the User <code>bob</code>’s Documents directory to the default <code>rstudio</code> user’s directory on the container. The above example shows a typical path on a Mac host, which can share any subdirectory under <code>Users</code>. A Linux host can link an arbitrary path. The same method should work on Windows paths as well, e.g.</p>
<pre class="bash"><code>docker run -d -p 8787:8787 -v /c/Users/foobar:/home/rstudio/foobar rocker/rstudio</code></pre>
<p>Would share the host’s file <code>C:/Users/foobar</code></p>
</div>
<div id="managing-users" class="tab-pane">
<h2 id="managing-users">Managing Users</h2>
<p>When using an RStudio-based instance over a public network (e.g. cloud server), remember to launch RStudio with a custom password as an environmental variable <code>-e</code>:</p>
<pre class="bash"><code>docker run -d -p 8787:8787 -e PASSWORD=clever-custom-password rocker/rstudio</code></pre>
<p>In this example, the default user remains <code>rstudio</code>, but now has a custom password. There is generally no need to set a custom user name, even when sharing volumes with the host user. On Linux-based hosts, sharing volumes requires that the the UID on the container match the UID on the host, otherwise any files edited or created in the container will be owned by <code>root</code> instead. Check the user id on the host (<code>id</code>) and pass this value to the docker container as an environmental variable, <code>-e USERID=$UID</code>, where <code>$UID</code> is the local user id.</p>
<p>By default, all rocker images run as root. This means that when running a terminal session such as <code>R</code> or <code>bash</code>, you will be a root user. This allows you to easily install additional software on the container with <code>apt-get</code> and perform other admin tasks. However, if you are sharing a local volume with the host, any files you create or modify will become owned by <code>root</code>. To avoid this, run interactive terminal sessions with the default user (<code>docker</code> for <code>r-base</code> containers, <code>rstudio</code> for RStudio containers) when sharing volumes with the host, e.g.:</p>
<pre class="bash"><code>docker run --rm -ti -v $(pwd):/home/rstudio --user rstudio rocker/verse bash</code></pre>
<p>or</p>
<pre class="bash"><code>docker run --rm -ti -v $(pwd):/home/docker --user docker r-base </code></pre>
<p>In these examples, we link the current working directory, <code>$(pwd)</code>, to a user-owned location on the image, and specify the approriate user name.</p>
<p>Note! When running RStudio from a container, always run the container as root (e.g. without specifying <code>--user rstudio</code>). The container needs root to launch RStudio, and then you will log in as a non-root user</p>
</div>
<div id="networking" class="tab-pane">
<h2 id="networking-tips-and-tricks">Networking: tips and tricks</h2>
<h3 id="https-https"><i class="material-icons">https</i> HTTPS</h3>
<p>Any RStudio instance on a remote server is accessed over an unencrypted http by default (though RStudio encrypts the password entered to log in through client-side javascript.) The easiest way to connect over a secure https connection is to use a reverse proxy server, such as <a href="https://caddyserver.com">Caddy</a>. To establish an encrypted https connection, you must first have control of a registered domain name: https cannot be used when connecting directly to a given ip address. Once you have pointed your domain name at the ip address of the server, Caddy provides a quick way to get set up with https using LetsEncrypt certificates. Below is an example <code>Caddyfile</code> specifying the necessary configuration, along with a <code>docker-compose</code> file which sets up an RStudio server instance behind a separate container running <code>caddy</code>. This approach also makes it easy to map ports to subdomains for cleaner-looking URLs:</p>
<p>Example <code>site/Caddyfile</code>:</p>
<pre><code>rstudio.example.com {
  
  tls you@email.com
  proxy / rstudio:8787 {
    header_upstream Host {host}
  }

}
</code></pre>
<p>Example docker-compose file:</p>
<pre class="yml"><code>version: &#39;2&#39;
services:
  caddy:  
    image: joshix/caddy
    links:
      - rstudio
    volumes:
      - ./site/:/var/www/html
      - ./.caddy/:/.caddy
    ports:
      - 80:80
      - 443:443
    restart: always

  rstudio:
    image: rocker/verse 
    env_file: .password 
    volumes:
      - $HOME/students:/home/
    restart: always</code></pre>
<p>More details about the use of <a href="https://docs.docker.com/compose/">docker-compose</a> and <a href="https://caddyserver.com/">Caddy Server</a> are found on their websites.</p>
<h3 id="data_usage-monitoring"><i class="material-icons">data_usage</i> Monitoring</h3>
<h3 id="linking-database-containers"><i class="fa fa-database"></i> Linking database containers</h3>
</div>
<div id="extending" class="tab-pane">
<h2 id="extending-images">Extending images</h2>
<div class="alert alert-warning">
<div class="container-fluid">
<div class="alert-icon">
<i class="material-icons">info_outline</i>
</div>
<button type="button" class="close" data-dismiss="alert" aria-label="Close">
<span aria-hidden="true"><i class="material-icons">clear</i></span>
</button>
<p>Coming soon…</p>
</div>
</div>
</div>
<div id="management" class="tab-pane">
<h2 id="managing-containers">Managing containers</h2>
<p>The simplest tools to monitor containers are <code>docker log</code> and <code>docker stats</code> commands.</p>
<h3 id="cleaning-up-stale-instances">Cleaning up stale instances</h3>
<p>Most of the examples shown here include the use of the <code>--rm</code> flag, which will cause this container to be removed after it has exited. By default, a container that is stopped (i.e. exited from) is not removed, and can be resumed later using <code>docker start</code>, be saved as a new docker image, or have files copied from it to the host (see the offical Docker documentation). However, most of the time we just forget about these containers, though they are still taking up disk space. You can view all stopped as well as running containers by using the <code>-a</code> flag to <code>docker ps</code>:</p>
<pre><code>docker ps -a</code></pre>
<p>and can remove all stopped containers by passing the id listed to <code>docker rm</code>. A shortcut to remove all stopped containers (but not any actively running ones) is:</p>
<pre><code>docker rm -v $(docker ps -a -q)</code></pre>
<p>This avoids filling up your filesystem with stale containers. This can be particularly useful if you often run containers without the <code>--rm</code> flag, such as when running RStudio containers in the background (“detached” mode, <code>docker run -d</code>).</p>
<h3 id="persistent-containers">Persistent containers</h3>
<p>Often a user might want a container to stay up and restart itself after stopping (such as when docker is upgraded on the host machine, or the host machine is restarted.) This is most common when working with a container accessed through RStudio.</p>
<p>Use <code>--restart=always</code> to have a container restart</p>
<h3 id="accessing-a-running-container">Accessing a running container</h3>
<p>Sometimes we need to access a container that is already up and running in the background, such as to install additional libraries. Some like to think of this as <code>ssh</code>-ing into their container, but there is no need to add <code>ssh</code> to accomplish this. Access a running container using the <code>docker exec</code> command, e.g.</p>
<pre><code>docker exec -ti &lt;container-id&gt; bash</code></pre>
<p>will drop us into a bash shell as the root user.</p>
</div>
<div id="other" class="tab-pane">
<h2 id="other-topics">Other topics</h2>
<div class="alert alert-warning">
<div class="container-fluid">
<div class="alert-icon">
<i class="material-icons">info_outline</i>
</div>
<button type="button" class="close" data-dismiss="alert" aria-label="Close">
<span aria-hidden="true"><i class="material-icons">clear</i></span>
</button>
<p>Coming soon…</p>
</div>
</div>
<ul>
<li>X11</li>
</ul>
<h2 id="rstudio-connectivity">RStudio connectivity</h2>
</div>
